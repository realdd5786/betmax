generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model User {
  id                       String             @id @default(auto()) @map("_id") @db.ObjectId
  email                    String             @unique
  passwordHash             String
  resetPasswordTokenHash   String?
  resetPasswordExpiresAt   DateTime?
  createdAt                DateTime           @default(now())
  updatedAt                DateTime           @updatedAt
  creditTransactions       CreditTransaction[]
  pixPurchases             PixPurchase[]
  analyses                 Analysis[]

  @@index([email])
}

model CreditTransaction {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  userId    String   @db.ObjectId
  type      String
  status    String
  amount    Int
  metadata  Json
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id])

  @@index([userId, createdAt])
}

model PixPurchase {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  userId      String   @db.ObjectId
  packageId   String
  amountBRL   Int
  status      String
  pixKey      String
  pixPayload  String
  qrCodeBase64 String?
  expiresAt   DateTime
  createdAt   DateTime @default(now())
  paidAt      DateTime?
  user        User     @relation(fields: [userId], references: [id])

  @@index([userId, createdAt])
}

model Analysis {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  userId      String   @db.ObjectId
  teamA       String
  teamB       String
  competition String
  matchDate   String?
  prompt      String
  resultJson  Json
  resultText  String
  costCredits Int
  createdAt   DateTime @default(now())
  user        User     @relation(fields: [userId], references: [id])

  @@index([userId, createdAt])
}
